# Merch App Codex

В репозитории представлен Go API и одностраничное приложение на Vue 3 для управления сущностями мерч-программы.

## Backend

1. Подготовьте базу данных MySQL и переменные окружения (см. `cmd/server/main.go`).
2. Выполните миграции и запустите HTTP-сервер:
   ```bash
   go run ./cmd/server
   ```

## Запуск через Docker Compose

1. Скопируйте файл `.env.example` в `.env` и задайте значения `APP_PORT`, `MYSQL_ROOT_PASSWORD` (и другие переменные при необходимости).
2. Соберите образы и запустите приложение вместе с MySQL:
   ```bash
   docker compose up -d --build
   ```
Переменные окружения для контейнера `app` описаны в `docker-compose.yml`. При необходимости отредактируйте файл перед запуском.
3. Для просмотра логов используйте:
   ```bash
   docker compose logs -f app
   ```

### Применение миграций

Миграции запускаются автоматически при старте Go-сервера. Чтобы повторно применить их вручную (например, после обновления файлов в `db/migrations`), перезапустите контейнер приложения:

```bash
docker compose restart app
```

Либо выполните одноразовый запуск контейнера:

```bash
docker compose run --rm app ./server
```

### Деплой по SSH

1. Скопируйте репозиторий на сервер (например, с помощью `git clone` или `scp`).
2. Убедитесь, что на сервере установлены Docker и Docker Compose v2.
3. Скопируйте файл `.env` (если он используется для локальных переменных) и при необходимости обновите `docker-compose.yml`.
4. На сервере выполните:
   ```bash
   docker compose up -d --build
   ```
5. Для обновления после изменения кода повторите сборку и выполните `docker compose up -d --build`, либо перезапустите отдельный сервис через `docker compose restart app`.

## Frontend

Приложение расположено в каталоге [`web/`](web/). Оно использует Vue 3, Vite и библиотеку компонентов PrimeVue.

### Подготовка

```bash
cd web
npm install
```

### Конфигурация

API по умолчанию ожидается на `http://localhost:8080/api`. Для изменения адреса задайте переменную окружения `VITE_API_URL`:

```bash
export VITE_API_URL="https://example.com/api"
```

### Запуск в режиме разработки

```bash
npm run dev -- --host
```

### Сборка production-версии

```bash
npm run build
```

Готовые файлы будут в директории `web/dist`. Для предпросмотра можно запустить:

```bash
npm run preview -- --host
```

### Функциональность

- Авторизация по email и паролю с сохранением токена и авто-перезапросом при истечении сессии.
- CRUD-интерфейсы для пользователей, компаний, торговых точек, брендов, категорий, продуктов, визитов и их позиций.
- Просмотр агрегированного отчёта по визитам компании.
